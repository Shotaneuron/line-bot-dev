<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ã‚¹ãƒãƒ›ä¾å­˜ãƒã‚§ãƒƒã‚¯ | åŒ—å¤§å¿ƒç†ã‚¼ãƒŸ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: 'Zen Maru Gothic', sans-serif; background: #0f172a; color: white; min-height: 100vh; }
        .glass-panel { background: rgba(30, 41, 59, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .choice-btn { transition: transform 0.1s; border: 1px solid rgba(255,255,255,0.1); }
        .choice-btn:active { transform: scale(0.96); background: rgba(255,255,255,0.2); }
        .btn-hover:active { transform: scale(0.95); }
    </style>
</head>
<body class="safe-area-inset-top p-6 flex flex-col">
    <header class="text-center mb-6">
        <h1 class="text-xl font-black text-slate-100">ã‚¹ãƒãƒ›ä¾å­˜ãƒã‚§ãƒƒã‚¯ ğŸ“±</h1>
    </header>

    <main class="flex-1 flex flex-col justify-center">
        <div id="intro-area" class="glass-panel rounded-[3rem] p-8 shadow-2xl text-center">
            <div class="text-5xl mb-4">ğŸ”‹</div>
            <h2 class="text-lg font-black text-slate-100 mb-4">ãƒãƒ¢ãƒ•ã‚©ãƒ“ã‚¢å±é™ºåº¦ãƒ†ã‚¹ãƒˆ</h2>
            <p class="text-sm text-slate-300 font-bold leading-relaxed mb-6 text-left">
                ç±³ã‚¢ã‚¤ã‚ªãƒ¯å·ç«‹å¤§å­¦ã§é–‹ç™ºã•ã‚ŒãŸã€Œãƒãƒ¢ãƒ•ã‚©ãƒ“ã‚¢ï¼ˆæºå¸¯é›»è©±ãŒãªã„ææ€–ç—‡ï¼‰ã€ã®åˆ¤å®šãƒ†ã‚¹ãƒˆã§ã™ã€‚ã‚ãªãŸãŒã©ã‚Œãã‚‰ã„ã‚¹ãƒãƒ›ã«ä¾å­˜ã—ã¦ã„ã‚‹ã‹ã‚’æ¸¬å®šã—ã¾ã™ã€‚<br><br>å…¨20å•ã€ã‚ã‚Šã®ã¾ã¾ã‚’ãŠç­”ãˆãã ã•ã„ï¼
            </p>
            <button onclick="startTest()" class="w-full py-4 bg-cyan-500 rounded-[2rem] font-black text-slate-900 shadow-lg btn-hover">
                ãƒ†ã‚¹ãƒˆã‚’å§‹ã‚ã‚‹ ğŸ‘‰
            </button>
        </div>

        <div id="quiz-area" class="glass-panel rounded-[3rem] p-6 shadow-2xl relative overflow-hidden" style="display: none;">
            <div class="absolute top-0 left-0 w-full h-1.5 bg-slate-800">
                <div id="progress" class="h-full bg-cyan-400 transition-all duration-300" style="width: 0%"></div>
            </div>
            
            <div class="pt-2 text-center">
                <span id="q-number" class="block text-[11px] font-black text-slate-400 tracking-widest mb-2">Q 01 / 20</span>
                <h2 id="q-text" class="text-[15px] font-black mt-2 mb-6 leading-relaxed text-slate-100 min-h-[4rem]"></h2>
                
                <div class="grid grid-cols-1 gap-2">
                    <button onclick="answer(7)" class="choice-btn w-full py-3 bg-slate-800 rounded-xl text-xs font-bold text-slate-200">å®Œå…¨ã«å½“ã¦ã¯ã¾ã‚‹ (7ç‚¹)</button>
                    <button onclick="answer(6)" class="choice-btn w-full py-3 bg-slate-800 rounded-xl text-xs font-bold text-slate-200">ã‹ãªã‚Šå½“ã¦ã¯ã¾ã‚‹ (6ç‚¹)</button>
                    <button onclick="answer(5)" class="choice-btn w-full py-3 bg-slate-800 rounded-xl text-xs font-bold text-slate-200">ã‚„ã‚„å½“ã¦ã¯ã¾ã‚‹ (5ç‚¹)</button>
                    <button onclick="answer(4)" class="choice-btn w-full py-3 bg-slate-800 rounded-xl text-xs font-bold text-slate-200">ã©ã¡ã‚‰ã¨ã‚‚ã„ãˆãªã„ (4ç‚¹)</button>
                    <button onclick="answer(3)" class="choice-btn w-full py-3 bg-slate-800 rounded-xl text-xs font-bold text-slate-200">ã‚ã¾ã‚Šå½“ã¦ã¯ã¾ã‚‰ãªã„ (3ç‚¹)</button>
                    <button onclick="answer(2)" class="choice-btn w-full py-3 bg-slate-800 rounded-xl text-xs font-bold text-slate-200">ã»ã¨ã‚“ã©å½“ã¦ã¯ã¾ã‚‰ãªã„ (2ç‚¹)</button>
                    <button onclick="answer(1)" class="choice-btn w-full py-3 bg-slate-800 rounded-xl text-xs font-bold text-slate-200">å…¨ãå½“ã¦ã¯ã¾ã‚‰ãªã„ (1ç‚¹)</button>
                </div>

                <button id="back-btn" onclick="goBack()" class="mt-5 text-xs font-bold text-slate-400 underline" style="display: none;">â—€ ä¸€ã¤å‰ã®å•é¡Œã«æˆ»ã‚‹</button>
            </div>
        </div>
    </main>

    <script>
        const questions = [
            "ã‚¹ãƒãƒ›ã§ã¤ã­ã«æƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã¨è½ã¡ç€ã‹ãªã„ã€‚",
            "æƒ…å ±ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸã„ã¨ãã«ã‚¹ãƒãƒ›ãŒãªã„ã¨ã‚¤ãƒ©ã‚¤ãƒ©ã™ã‚‹ã€‚",
            "ã‚¹ãƒãƒ›ã§æœ€æ–°ã®æƒ…å ±ã‚’ãƒã‚§ãƒƒã‚¯ã§ããªã„ã¨ã‚¤ãƒ©ã‚¤ãƒ©ã™ã‚‹ã€‚",
            "ã‚¢ãƒ—ãƒªã‚’ä½¿ã„ãŸã„ã¨ãã«ã‚¹ãƒãƒ›ãŒãªã„ã¨ã‚¤ãƒ©ã‚¤ãƒ©ã™ã‚‹ã€‚",
            "ãƒãƒƒãƒ†ãƒªãƒ¼ãŒåˆ‡ã‚Œãã†ã«ãªã‚‹ã¨ãƒ‰ã‚­ãƒ‰ã‚­ã™ã‚‹ã€‚",
            "åˆ©ç”¨å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ã®ä¸Šé™ã«é”ã™ã‚‹ã¨ã€ã‚ªãƒ­ã‚ªãƒ­ã—ã¦ã—ã¾ã†ã€‚",
            "é›»æ³¢ã‚„WiFiãŒå…¥ã‚‰ãªããªã‚‹ã¨ã€ã¤ã„ä½•åº¦ã‚‚æ¢ã—ã¦ã—ã¾ã†ã€‚",
            "ã‚‚ã—ã‚¹ãƒãƒ›ãŒãªããªã£ãŸã‚‰ã€ä½•ã‚‚ã§ããªããªã£ã¦ã—ã¾ã†ã ã‚ã†ã€‚",
            "ã—ã°ã‚‰ãã‚¹ãƒãƒ›ã‚’ãƒã‚§ãƒƒã‚¯ã§ããªã„ã¨ã€æ›´æ–°ã—ãŸãã¦ãŸã¾ã‚‰ãªããªã‚‹ã€‚",
            "ã‚¹ãƒãƒ›ã‚’å¤±ãã—ãŸã‚‰ã€å®¶æ—ã‚„å‹äººã¨ã™ãã«é€£çµ¡ã§ããšä¸å®‰ã«ãªã‚‹ã€‚",
            "ã‚¹ãƒãƒ›ã‚’å¤±ãã—ãŸã‚‰ã€å®¶æ—ã‚„å‹äººãŒè‡ªåˆ†ã«é€£çµ¡ã§ããªãã¦ä¸å®‰ã«ãªã‚‹ã€‚",
            "ã‚¹ãƒãƒ›ã‚’å¤±ãã—ãŸã‚‰ã€LINEãƒ»ãƒ¡ãƒ¼ãƒ«ãƒ»ç€ä¿¡ã‚’å–ã‚Œãªãã¦ã‚¤ãƒ©ã‚¤ãƒ©ã™ã‚‹ã€‚",
            "ã‚¹ãƒãƒ›ã‚’å¤±ãã—ãŸã‚‰ã€å®¶æ—ã‚„å‹äººã¨é€£çµ¡ãŒå–ã‚Œãšä¸å®‰ã«ãªã‚‹ã€‚",
            "ã‚¹ãƒãƒ›ã‚’å¤±ãã—ãŸã‚‰ã€èª°ãŒè‡ªåˆ†ã«é€£çµ¡ã—ã‚ˆã†ã¨ã—ãŸã‹åˆ†ã‹ã‚‰ãšä¸å®‰ã«ãªã‚‹ã€‚",
            "ã‚¹ãƒãƒ›ã‚’å¤±ãã—ãŸã‚‰ã€å®¶æ—ã‚„å‹äººã¨ã®é–¢ä¿‚ãŒå£Šã‚Œã‚‹ã®ã‚’ä¸å®‰ã«æ€ã†ã€‚",
            "ã‚¹ãƒãƒ›ã‚’å¤±ãã—ãŸã‚‰ã€ãƒªã‚¢ãƒ«ã®è‡ªåˆ†ã¨ãƒãƒƒãƒˆä¸Šã®è‡ªåˆ†ãŒåˆ‡ã‚Šé›¢ã•ã‚Œã¦ã‚¤ãƒ©ã‚¤ãƒ©ã™ã‚‹ã€‚",
            "ã‚¹ãƒãƒ›ã‚’å¤±ãã—ãŸã‚‰ã€SNSã‚„ãƒãƒƒãƒˆãƒ‹ãƒ¥ãƒ¼ã‚¹ã«ç€ã„ã¦è¡Œã‘ãšè½ã¡ç€ã‹ãªã„ã€‚",
            "ã‚¹ãƒãƒ›ã‚’å¤±ãã—ãŸã‚‰ã€SNSã‚„LINEã®é€šçŸ¥ãŒãƒã‚§ãƒƒã‚¯ã§ããªãã¦è½ã¡ç€ã‹ãªã„ã€‚",
            "ã‚¹ãƒãƒ›ã‚’å¤±ãã—ãŸã‚‰ã€ãƒ¡ãƒ¼ãƒ«ãŒãƒã‚§ãƒƒã‚¯ã§ããªãã¦ä¸å®‰ã«ãªã‚‹ã€‚",
            "ã‚¹ãƒãƒ›ã‚’å¤±ãã—ãŸã‚‰ã€ä½•ã‚’ã—ã¦ã„ã„ã‹ã‚ã‹ã‚‰ãšå¤‰ãªæ°—åˆ†ã«ãªã‚‹ã€‚"
        ];

        let current = 0;
        let totalScore = 0;
        let answerHistory = []; // æˆ»ã‚‹ãƒœã‚¿ãƒ³ç”¨ã«å±¥æ­´ã‚’ä¿å­˜
        let userId = "";

        async function init() {
            await liff.init({ liffId: "2009176797-S5FV668D" });
            if (!liff.isLoggedIn()) { liff.login(); return; }
            userId = (await liff.getProfile()).userId;
        }

        function startTest() {
            document.getElementById('intro-area').style.display = 'none';
            document.getElementById('quiz-area').style.display = 'block';
            showQ();
        }

        function showQ() {
            document.getElementById('q-number').innerText = `Q ${String(current+1).padStart(2,'0')} / 20`;
            document.getElementById('q-text').innerText = questions[current];
            document.getElementById('progress').style.width = `${(current / 20) * 100}%`;
            document.getElementById('back-btn').style.display = current > 0 ? 'inline-block' : 'none';
        }

        async function answer(val) {
            totalScore += val;
            answerHistory.push(val);
            current++;
            if (current < questions.length) { showQ(); } 
            else { await saveResult(); }
        }

        function goBack() {
            if (current > 0) {
                current--;
                const lastVal = answerHistory.pop();
                totalScore -= lastVal; // ã‚¹ã‚³ã‚¢ã‚’å…ƒã«æˆ»ã™
                showQ();
            }
        }

        async function saveResult() {
            document.getElementById('quiz-area').innerHTML = `<div class="text-center py-10"><div class="animate-spin text-4xl mb-4 text-cyan-500">ğŸŒ€</div><p class="font-black text-slate-100">åˆ†æä¸­...</p></div>`;
            try {
                let level = "";
                if (totalScore <= 27) level = "å•é¡Œãªã—";
                else if (totalScore <= 55) level = "ã‚¹ãƒãƒ›ä¾å­˜ äºˆå‚™è»";
                else if (totalScore <= 83) level = "è»½åº¦ã®ä¾å­˜ç—‡";
                else if (totalScore <= 111) level = "é‡åº¦ã®ä¾å­˜ç—‡";
                else level = "å®Œå…¨ãªä¾å­˜ç—‡ (ãƒãƒ¢ãƒ•ã‚©ãƒ“ã‚¢)";

                const data = { total: totalScore };
                const apiKey = "AIzaSyD6qGmXgiLp0W7VhNdQYBnCzMnq4TNiQdk";
                const url = `https://firestore.googleapis.com/v1/projects/shinrizemi-linebot/databases/default/documents/users/${userId}?updateMask.fieldPaths=nomophobiaResult&updateMask.fieldPaths=nomophobiaDate&updateMask.fieldPaths=nomophobiaScores&key=${apiKey}`;
                
                await fetch(url, {
                    method: 'PATCH', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ fields: { nomophobiaResult: { stringValue: level }, nomophobiaDate: { timestampValue: new Date().toISOString() }, nomophobiaScores: { stringValue: JSON.stringify(data) } } })
                });
                window.location.href = "result.html?type=nomophobia";
            } catch (e) { alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚"); window.location.href = "result.html?type=nomophobia"; }
        }
        init();
    </script>
</body>
</html>