<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>ã‚¯ãƒ­ãƒã‚¿ã‚¤ãƒ—è¨ºæ–­ | åŒ—å¤§å¿ƒç†ã‚¼ãƒŸ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: 'Zen Maru Gothic', sans-serif; background: linear-gradient(-45deg, #10b981, #3b82f6, #6366f1, #8b5cf6); background-size: 400% 400%; animation: aurora 20s ease infinite; min-height: 100vh; display: flex; flex-direction: column; }
        @keyframes aurora { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .glass-panel { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.4); }
        .choice-btn { transition: all 0.2s ease; border: 1px solid rgba(0,0,0,0.05); }
        .choice-btn:active { transform: scale(0.95); background-color: #f0f9ff; }
        .progress-bar { transition: width 0.4s ease-out; }
    </style>
</head>
<body class="safe-area-inset-top p-6">
    <header class="text-center mb-6">
        <p class="text-[10px] font-black text-white/80 tracking-[0.3em] mb-1">HOKKAIDO UNIVERSITY</p>
        <h1 class="text-xl font-black text-white drop-shadow-md">ã‚¯ãƒ­ãƒã‚¿ã‚¤ãƒ—è¨ºæ–­ ğŸ»ğŸ¦ğŸºğŸ¬</h1>
    </header>

    <main class="flex-1 flex flex-col justify-center">
        <div id="intro-area" class="glass-panel rounded-[3rem] p-8 shadow-2xl text-center">
            <div class="text-5xl mb-4">â°</div>
            <h2 class="text-lg font-black text-slate-800 mb-4">ã‚ãªãŸã®ã€Œæœ€å¼·ã®æ™‚é–“å¸¯ã€ã¯ï¼Ÿ</h2>
            <p class="text-sm text-slate-700 font-bold leading-relaxed mb-6 text-left">
                äººé–“ã®ä½“å†…æ™‚è¨ˆã¯ã€éºä¼çš„ã«4ã¤ã®å‹•ç‰©ã‚¿ã‚¤ãƒ—ã«åˆ†ã‹ã‚Œã¦ã„ã¾ã™ã€‚<br><br>
                ã“ã®å®Œå…¨ç‰ˆãƒ†ã‚¹ãƒˆã§ã¯ã€ã¾ãšãƒ‘ãƒ¼ãƒˆ1ã§ã€Œã‚¤ãƒ«ã‚«å‹ã€ã‹ã‚’åˆ¤å®šã—ã€ãã®å¾Œãƒ‘ãƒ¼ãƒˆ2ã§æ®‹ã‚Šã®ã‚¿ã‚¤ãƒ—ã‚’ç²¾å¯†ã«åˆ†æã—ã¾ã™ï¼
            </p>
            <button onclick="startTest()" class="w-full py-4 bg-emerald-500 rounded-[2rem] font-black text-white shadow-lg text-lg choice-btn">
                è¨ºæ–­ã‚’ã‚¹ã‚¿ãƒ¼ãƒˆï¼ âœ¨
            </button>
        </div>

        <div id="quiz-area" class="glass-panel rounded-[3rem] p-6 shadow-2xl relative overflow-hidden" style="display: none;">
            <div class="absolute top-0 left-0 w-full h-1.5 bg-slate-200">
                <div id="progress" class="progress-bar h-full bg-emerald-500" style="width: 0%"></div>
            </div>
            <div class="pt-2 text-center">
                <span id="part-badge" class="inline-block bg-emerald-100 text-emerald-600 text-[10px] font-black px-2 py-1 rounded mb-2 uppercase tracking-widest">Part 1</span>
                <span id="q-number" class="block text-[10px] font-black text-slate-400 tracking-widest uppercase mb-1">Q 01 / 10</span>
                <h2 id="q-text" class="text-[16px] font-black mt-2 mb-6 leading-relaxed text-slate-800 min-h-[4rem]"></h2>
                
                <div id="choices-container" class="grid grid-cols-1 gap-3">
                    </div>
                <button id="back-btn" onclick="goBack()" class="mt-5 text-xs font-bold text-slate-400 underline" style="display: none;">â—€ ä¸€ã¤å‰ã®å•é¡Œã«æˆ»ã‚‹</button>
            </div>
        </div>
    </main>
    <footer class="mt-6 text-center"><p class="text-[10px] text-white/60 tracking-widest uppercase">Â© 2026 åŒ—å¤§å¿ƒç†ã‚¼ãƒŸ</p></footer>

    <script>
    // ãƒ‘ãƒ¼ãƒˆ1ï¼šã‚¤ãƒ«ã‚«åˆ¤å®šï¼ˆ10å• Yes/Noï¼‰
    const part1Questions = [ "ã‚ãšã‹ãªéŸ³ã‚„å…‰ã§ç›®ãŒè¦šã‚ã¦ã—ã¾ã†", "é£Ÿã¹ç‰©ã¸ã®æƒ…ç†±ã¯ãã‚Œã»ã©ãªã„", "ã‚¢ãƒ©ãƒ¼ãƒ ãŒé³´ã‚‹å‰ã«èµ·ãã‚‹ã“ã¨ãŒå¤šã„", "é£›è¡Œæ©Ÿã§ã†ã¾ãçœ ã‚Œãªã„", "ç–²ã‚Œã‚‹ã¨ã™ãã«ã‚¤ãƒ©ã‚¤ãƒ©ã™ã‚‹", "ã•ã•ã„ãªã“ã¨ã‚’æ‚©ã¿ã™ãã‚‹", "è‡ªåˆ†ã¯ä¸çœ ç—‡ã ã¨æ€ã†ï¼ˆã¾ãŸã¯è¨ºæ–­ã•ã‚ŒãŸï¼‰", "å­¦ç”Ÿã®ã“ã‚ã¯ã€æˆç¸¾ã«ã“ã ã‚ã‚‹ã»ã†ã ã£ãŸ", "ã„ã¤ã‚‚ã€Œç¡çœ ä¸è¶³ã ã€ã¨æ„Ÿã˜ã¦ã„ã‚‹", "ä½•ã‹èµ·ãã‚‹ã¨ã€éå»ãƒ»ç¾åœ¨ãƒ»æœªæ¥ã®é †ã«ç‰©äº‹ã‚’è€ƒãˆã‚‹" ];
    const part2Questions = [
        { t: "ç¿Œæ—¥ã«ä½•ã®äºˆå®šã‚‚ãªã„æ—¥ã®ã€ç†æƒ³ã®èµ·åºŠæ™‚é–“ã¯ï¼Ÿ", choices: [{text: "åˆå‰6æ™‚åŠã‚ˆã‚Šå‰", score: 1}, {text: "åˆå‰6æ™‚åŠã€œåˆå‰8æ™‚45åˆ†", score: 2}, {text: "åˆå‰8æ™‚45åˆ†ä»¥é™", score: 3}] },
        { t: "æ™‚å·®ãƒœã‚±ã«ã¯ã©ã‚Œãã‚‰ã„é©å¿œã§ãã‚‹ï¼Ÿ", choices: [{text: "ã™ãã«é©å¿œã§ãã‚‹", score: 1}, {text: "48æ™‚é–“ãã‚‰ã„ã§é©å¿œã™ã‚‹", score: 2}, {text: "ãšã£ã¨å¼•ããšã‚‹", score: 3}, {text: "æ™‚å·®ãƒœã‚±ã«ãªã‚Šã‚„ã™ã„", score: 4}] },
        { t: "ä¸€æ—¥ã®ã†ã¡ã€ä¸€ç•ªã‚¤ãƒ©ã‚¤ãƒ©ã—ã‚„ã™ã„æ™‚é–“ã¯ï¼Ÿ", choices: [{text: "ç–²ã‚Œã¦ãã‚‹å¤•æ–¹ä»¥é™", score: 1}, {text: "æœèµ·ããŸç›´å¾Œ", score: 3}, {text: "ä¸€æ—¥ä¸­ãªã‚“ã¨ãªã", score: 4}] },
        { t: "è‡ªåˆ†ã®ã“ã¨ã‚’ã€Œå®Œç’§ä¸»ç¾©ã€ã ã¨æ€ã†ï¼Ÿ", choices: [{text: "çµ¶å¯¾ãã†æ€ã†", score: 1}, {text: "ã©ã¡ã‚‰ã‹ã¨ã„ã†ã¨ãã†", score: 2}, {text: "ã‚ã¾ã‚Šãã†æ€ã‚ãªã„", score: 4}] },
        { t: "ä¼‘æ—¥ã®å¯ã ã‚ã«ã¤ã„ã¦ã©ã†æ€ã†ï¼Ÿ", choices: [{text: "ã‚ã¾ã‚Šã—ãªã„ãƒ»ã§ããªã„", score: 1}, {text: "æ•°æ™‚é–“ã¯é•·ãå¯ã‚‹", score: 2}, {text: "ä¼‘æ—¥ã¯æ˜¼ã¾ã§çˆ†ç¡ã™ã‚‹", score: 3}, {text: "å¯ã ã‚ã—ã¦ã‚‚ç–²ã‚ŒãŒå–ã‚Œãªã„", score: 4}] },
        { t: "æœã”ã¯ã‚“ã¯ã—ã£ã‹ã‚Šé£Ÿã¹ã‚‹ã»ã†ï¼Ÿ", choices: [{text: "èµ·ãã¦ã™ãã‚¬ãƒƒãƒ„ãƒªé£Ÿã¹ã‚‹", score: 1}, {text: "å°‘ã—æ™‚é–“ãŒçµŒã£ã¦ã‹ã‚‰é£Ÿã¹ã‚‹", score: 2}, {text: "æœã¯é£Ÿæ¬²ãŒãªã„", score: 3}, {text: "é£Ÿã¹ãŸã‚Šé£Ÿã¹ãªã‹ã£ãŸã‚Š", score: 4}] },
        { t: "å­¦ç”Ÿæ™‚ä»£ã®ãƒ†ã‚¹ãƒˆå‹‰å¼·ã¯ã„ã¤ã‚„ã‚‹ã®ãŒä¸€ç•ªæ—ã£ãŸï¼Ÿ", choices: [{text: "æ—©èµ·ãã—ã¦æœã«ã‚„ã‚‹", score: 1}, {text: "å­¦æ ¡ã‹ã‚‰å¸°ã£ã¦å¤•æ–¹ã¾ã§", score: 2}, {text: "æ·±å¤œã¾ã§å¾¹å¤œã§ã‚„ã‚‹", score: 3}, {text: "æ°—åˆ†ã«ã‚ˆã£ã¦ãƒãƒ©ãƒãƒ©", score: 4}] },
        { t: "ã‚«ãƒ•ã‚§ã‚¤ãƒ³ï¼ˆã‚³ãƒ¼ãƒ’ãƒ¼ç­‰ï¼‰ã‚’é£²ã‚€ã¨ã©ã†ãªã‚‹ï¼Ÿ", choices: [{text: "å¤•æ–¹ä»¥é™ã«é£²ã‚€ã¨çœ ã‚Œãªã„", score: 1}, {text: "ã‚ã¾ã‚Šå½±éŸ¿ã‚’æ„Ÿã˜ãªã„", score: 2}, {text: "å¯ã‚‹ç›´å‰ã§ã‚‚é£²ã‚ã‚‹", score: 3}, {text: "ã‚«ãƒ•ã‚§ã‚¤ãƒ³ã«ã‹ãªã‚Šæ•æ„Ÿ", score: 4}] },
        { t: "æ¯æ—¥ã®ç¡çœ ã®æ·±ã•ã¯ï¼Ÿ", choices: [{text: "ãŸã¾ã«é€”ä¸­ã§ç›®ãŒè¦šã‚ã‚‹", score: 1}, {text: "é€”ä¸­ã§èµ·ãã‚‹ã“ã¨ãªãç†Ÿç¡", score: 2}, {text: "å°‘ã—ã®ç‰©éŸ³ã§èµ·ãã¦ã—ã¾ã†", score: 4}] },
        { t: "è‡ªåˆ†ã®æ€§æ ¼ã‚’æœ€ã‚‚è¡¨ã—ã¦ã„ã‚‹ã®ã¯ï¼Ÿ", choices: [{text: "ç¾å®Ÿçš„ãƒ»æˆ¦ç•¥çš„", score: 1}, {text: "è¦ªåˆ‡ãƒ»æ¥½è¦³çš„", score: 2}, {text: "å‰µé€ çš„ãƒ»æ°—åˆ†å±‹", score: 3}, {text: "ç¥çµŒè³ªãƒ»çŸ¥çš„", score: 4}] }
    ];

    let isPart2 = false;
    let current = 0;
    let userAnswersPart1 = []; 
    let userAnswersPart2 = [];
    let userId = "";

    async function initializeLiff() {
        try {
            await liff.init({ liffId: "2009176797-L8SmhOdw" }); 
            if (!liff.isLoggedIn()) { liff.login(); return; }
            userId = (await liff.getProfile()).userId;
        } catch (err) { console.warn("LIFFã‚¨ãƒ©ãƒ¼:", err); }
    }

    function startTest() {
        document.getElementById('intro-area').style.display = 'none';
        document.getElementById('quiz-area').style.display = 'block';
        updateUI();
    }

    function updateUI() {
        const container = document.getElementById('choices-container');
        container.innerHTML = "";
        // æˆ»ã‚‹ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºãƒ»éè¡¨ç¤ºï¼ˆæœ€åˆã®å•é¡Œä»¥å¤–ã¯è¡¨ç¤ºï¼‰
        document.getElementById('back-btn').style.display = current > 0 ? 'inline-block' : 'none';

        if (!isPart2) {
            document.getElementById('part-badge').innerText = "Part 1";
            document.getElementById('part-badge').className = "inline-block bg-emerald-100 text-emerald-600 text-[10px] font-black px-2 py-1 rounded mb-2 uppercase tracking-widest";
            document.getElementById('q-number').innerText = `Q ${String(current+1).padStart(2, '0')} / 10`;
            document.getElementById('q-text').innerText = part1Questions[current];
            document.getElementById('progress').style.width = `${(current / 10) * 100}%`;
            
            ["ã¯ã„", "ã„ã„ãˆ"].forEach((ans, idx) => {
                const btn = document.createElement('button');
                btn.className = "choice-btn w-full py-4 bg-white rounded-2xl text-sm font-black text-slate-800 shadow-sm border-2 border-slate-100";
                btn.innerText = ans;
                btn.onclick = () => answerPart1(idx === 0);
                container.appendChild(btn);
            });
        } else {
            document.getElementById('part-badge').innerText = "Part 2";
            document.getElementById('part-badge').className = "inline-block bg-blue-100 text-blue-600 text-[10px] font-black px-2 py-1 rounded mb-2 uppercase tracking-widest";
            document.getElementById('q-number').innerText = `Q ${String(current+1).padStart(2, '0')} / 10`;
            const q = part2Questions[current];
            document.getElementById('q-text').innerText = q.t;
            document.getElementById('progress').style.width = `${(current / 10) * 100}%`;
            document.getElementById('progress').className = "progress-bar h-full bg-blue-500";
            
            q.choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = "choice-btn w-full py-4 bg-white rounded-2xl text-sm font-black text-slate-800 shadow-sm border-2 border-slate-100";
                btn.innerText = choice.text;
                btn.onclick = () => answerPart2(choice.score);
                container.appendChild(btn);
            });
        }
    }

    function goBack() {
        if (current > 0) {
            current--;
            updateUI();
        }
    }

    function answerPart1(isYes) {
        userAnswersPart1[current] = isYes;
        current++;
        if (current < 10) {
            updateUI();
        } else {
            const part1Score = userAnswersPart1.filter(v => v).length;
            if (part1Score >= 7) {
                saveAndRedirect("ã‚¤ãƒ«ã‚«ï¼ˆä¸è¦å‰‡å‹ï¼‰");
            } else {
                isPart2 = true;
                current = 0;
                document.getElementById('quiz-area').innerHTML = `<div class="text-center py-10"><div class="text-4xl mb-4">ğŸ”</div><p class="font-black text-slate-800">Part 2 ã¸é€²ã¿ã¾ã™...</p></div>`;
                setTimeout(() => {
                    document.getElementById('quiz-area').innerHTML = `
                        <div class="absolute top-0 left-0 w-full h-1.5 bg-slate-200"><div id="progress" class="progress-bar h-full bg-blue-500" style="width: 0%"></div></div>
                        <div class="pt-2 text-center">
                            <span id="part-badge"></span><span id="q-number" class="block text-[10px] font-black text-slate-400 tracking-widest uppercase mb-1"></span>
                            <h2 id="q-text" class="text-[16px] font-black mt-2 mb-6 leading-relaxed text-slate-800 min-h-[4rem]"></h2>
                            <div id="choices-container" class="grid grid-cols-1 gap-3"></div>
                            <button id="back-btn" onclick="goBack()" class="mt-5 text-xs font-bold text-slate-400 underline" style="display: none;">â—€ ä¸€ã¤å‰ã®å•é¡Œã«æˆ»ã‚‹</button>
                        </div>`;
                    updateUI();
                }, 1500);
            }
        }
    }

    function answerPart2(score) {
        userAnswersPart2[current] = score;
        current++;
        if (current < 10) {
            updateUI();
        } else {
            const part2Score = userAnswersPart2.reduce((a, b) => a + b, 0);
            let type = "";
            if (part2Score <= 16) type = "ãƒ©ã‚¤ã‚ªãƒ³ï¼ˆæœå‹ï¼‰";
            else if (part2Score <= 23) type = "ã‚¯ãƒï¼ˆæ˜¼å‹ï¼‰";
            else if (part2Score <= 30) type = "ã‚ªã‚ªã‚«ãƒŸï¼ˆå¤œå‹ï¼‰";
            else type = "ã‚¤ãƒ«ã‚«ï¼ˆä¸è¦å‰‡å‹ï¼‰";
            
            saveAndRedirect(type);
        }
    }

    async function saveAndRedirect(type) {
        document.getElementById('quiz-area').innerHTML = `<div class="text-center py-10"><div class="animate-spin text-4xl mb-4">ğŸŒ€</div><p class="font-black text-slate-800">æœ€é©ãªæ™‚é–“å¸¯ã‚’åˆ†æä¸­...</p></div>`;
        if (userId) {
            const apiKey = "AIzaSyD6qGmXgiLp0W7VhNdQYBnCzMnq4TNiQdk";
            const url = `https://firestore.googleapis.com/v1/projects/shinrizemi-linebot/databases/default/documents/users/${userId}?updateMask.fieldPaths=chronoResult&updateMask.fieldPaths=chronoDate&updateMask.fieldPaths=latestTest&key=${apiKey}`;
            const payload = { fields: { chronoResult: { stringValue: type }, chronoDate: { timestampValue: new Date().toISOString() }, latestTest: { stringValue: "chronotype" } } };
            try { await fetch(url, { method: 'PATCH', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }); } catch (err) {}
        }
        window.location.href = "result.html?type=chronotype";
    }

    initializeLiff();
    </script>
</body>
</html>