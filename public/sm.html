<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ç©ºæ°—èª­ã‚ã‚‹ã‹è¨ºæ–­ | åŒ—å¤§å¿ƒç†ã‚¼ãƒŸ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: 'Zen Maru Gothic', sans-serif; background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%); min-height: 100vh; }
        .glass-panel { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.6); }
        .choice-btn { transition: transform 0.1s; }
        .choice-btn:active { transform: scale(0.96); }
        .btn-hover:active { transform: scale(0.95); }
    </style>
</head>
<body class="safe-area-inset-top p-6 flex flex-col">
    <header class="text-center mb-6">
        <p class="text-[10px] font-black text-pink-500 tracking-[0.3em] mb-1">HOKKAIDO UNIVERSITY</p>
        <h1 class="text-xl font-black text-slate-800">ç©ºæ°—èª­ã‚ã‚‹ã‹è¨ºæ–­ ğŸŒ¬ï¸</h1>
    </header>

    <main class="flex-1 flex flex-col justify-center">
        <div id="intro-area" class="glass-panel rounded-[3rem] p-8 shadow-xl text-center">
            <div class="text-5xl mb-4">ğŸ­</div>
            <h2 class="text-lg font-black text-slate-800 mb-4">ã‚ãªãŸã®ã€Œã‚«ãƒ¡ãƒ¬ã‚ªãƒ³åº¦ã€ã¯ï¼Ÿ</h2>
            <p class="text-sm text-slate-700 font-bold leading-relaxed mb-6 text-left">
                ç§‘å­¦çš„ã«æ­£ã—ã„ã€Œã‚»ãƒ«ãƒ•ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ï¼ˆSMï¼‰å°ºåº¦ã€ã‚’ç”¨ã„ã¦ã€ã‚ãªãŸãŒã©ã‚Œãã‚‰ã„ã€Œç©ºæ°—ã‚’èª­ã‚€ã€ã®ãŒå¾—æ„ã‹ã€ã‚ã‚‹ã„ã¯ã€Œè‡ªåˆ†ã‚’è²«ãã€ã‚¿ã‚¤ãƒ—ã‹ã‚’è¨ºæ–­ã—ã¾ã™ã€‚<br><br>å…¨13å•ã€ç›´æ„Ÿã§ãŠç­”ãˆãã ã•ã„ï¼
            </p>
            <button onclick="startTest()" class="w-full py-4 bg-pink-500 rounded-[2rem] font-black text-white shadow-lg btn-hover">
                ãƒ†ã‚¹ãƒˆã‚’å§‹ã‚ã‚‹ ğŸ‘‰
            </button>
        </div>

        <div id="quiz-area" class="glass-panel rounded-[3rem] p-6 shadow-xl relative overflow-hidden" style="display: none;">
            <div class="absolute top-0 left-0 w-full h-1.5 bg-slate-100">
                <div id="progress" class="h-full bg-pink-400 transition-all duration-300" style="width: 0%"></div>
            </div>
            
            <div class="pt-4 text-center">
                <span id="q-number" class="block text-[11px] font-black text-slate-400 tracking-widest mb-2">Q 01 / 13</span>
                <h2 id="q-text" class="text-[16px] font-black mt-2 mb-8 leading-relaxed text-slate-800 min-h-[4rem]"></h2>
                
                <div class="grid grid-cols-1 gap-3">
                    <button onclick="answer(4)" class="choice-btn w-full py-4 bg-white rounded-2xl text-sm font-bold text-slate-700 shadow-sm border-2 border-slate-100">ã‹ãªã‚Šå½“ã¦ã¯ã¾ã‚‹</button>
                    <button onclick="answer(3)" class="choice-btn w-full py-4 bg-white rounded-2xl text-sm font-bold text-slate-700 shadow-sm border-2 border-slate-100">ã‚„ã‚„å½“ã¦ã¯ã¾ã‚‹</button>
                    <button onclick="answer(2)" class="choice-btn w-full py-4 bg-white rounded-2xl text-sm font-bold text-slate-700 shadow-sm border-2 border-slate-100">ã‚ã¾ã‚Šå½“ã¦ã¯ã¾ã‚‰ãªã„</button>
                    <button onclick="answer(1)" class="choice-btn w-full py-4 bg-white rounded-2xl text-sm font-bold text-slate-700 shadow-sm border-2 border-slate-100">å…¨ãå½“ã¦ã¯ã¾ã‚‰ãªã„</button>
                </div>

                <button id="back-btn" onclick="goBack()" class="mt-6 text-xs font-bold text-slate-400 underline" style="display: none;">â—€ ä¸€ã¤å‰ã®å•é¡Œã«æˆ»ã‚‹</button>
            </div>
        </div>
    </main>

    <script>
        const questions = [
            "è©±ã‚’ã—ã¦ã„ã‚‹ã¨ãã«ã¯ã€ç›¸æ‰‹ã®è¡¨æƒ…ã®ã‚ãšã‹ãªå¤‰åŒ–ã«ã‚‚æ•æ„Ÿã«ãªã‚‹ã€‚",
            "ç›®ã‚’ã¿ã‚Œã°ã€ãã®äººã®ã»ã‚“ã¨ã†ã®æ°—æŒã¡ã‚’æ­£ç¢ºã«èª­ã¿å–ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚",
            "ã ã‚Œã‹ãŒè‡ªåˆ†ã«ã†ãã‚’ã¤ã„ã¦ã‚‚ã€è¡¨æƒ…ã‚„ã—ãã•ã§ã™ãã«è¦‹æŠœãã“ã¨ãŒã§ãã‚‹ã€‚",
            "ç›®ã‚’ã¿ã‚Œã°ã€è‡ªåˆ†ãŒç›¸æ‰‹ã«ä½•ã‹ä¸éƒ½åˆãªã“ã¨ã‚’è¨€ã£ãŸã‹ã©ã†ã‹åˆ†ã‹ã‚‹ã€‚",
            "ç›¸æ‰‹ãŒå†—è«‡ã‚’è´ã„ã¦ç¬‘ã£ã¦ã‚‚ã€å†…å¿ƒã§ã¯ä¸‹å“ã ã¨æ€ã£ã¦ã„ã‚‹ã‹ã‚’è¦‹æŠœã‘ã‚‹ã€‚",
            "ç§ã®ç›´æ„ŸåŠ›ã¯ã€ç›¸æ‰‹ã®æ°—æŒã¡ã‚„è¡Œã„ã®åŸå› ã‚’çŸ¥ã‚‹ã®ã«ã¨ã¦ã‚‚å½¹ã«ç«‹ã¤ã€‚",
            "ç›¸æ‰‹ã‚„çŠ¶æ³ã«å¿œã˜ã¦è‡ªåˆ†ã®è¡Œå‹•ã‚’å¤‰ãˆã‚‹ã®ãŒå¾—æ„ã§ã‚ã‚‹ã€‚",
            "ãã®å ´é¢ã§ã©ã†ãµã‚‹ã¾ãˆã°ã‚ˆã„ã‹åˆ†ã‹ã‚Œã°ã€è‡ªåˆ†ã®è¡Œå‹•ã‚’ãŸã‚„ã™ãå¤‰ãˆã‚‰ã‚Œã‚‹ã€‚",
            "è‡ªåˆ†ãŒä»Šã„ã‚‹å ´é¢ã§å¿…è¦ã¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã«å¿œã˜ã¦ã€è¡Œå‹•ã‚’å¤‰ãˆã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚",
            "ç‰©äº‹ãŒæ€ã„é€šã‚Šã«ã†ã¾ãã„ã‹ãªã„ã¨ãã«ã¯ã€ã™ãã«ä»–ã®ã‚„ã‚Šæ–¹ã«åˆ‡ã‚Šæ›ãˆã‚‹ã€‚",
            "è‡ªåˆ†ã®ãŸã‚ã«ãªã‚‹ã¨åˆ†ã‹ã£ã¦ã„ã¦ã‚‚ã€ä½“è£ã‚’ã‚ˆãã™ã‚‹ã®ãŒè‹¦æ‰‹ã§ã¯ãªã„ã€‚",
            "ã¾ã‚ã‚Šã®äººãŒæœ›ã‚“ã§ã„ã‚‹ã“ã¨ã«å¿œã˜ã¦ã€è‡ªåˆ†ã®è¡Œå‹•ã‚’å¤‰ãˆã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚",
            "ç›¸æ‰‹ã«ã©ã®ã‚ˆã†ãªå°è±¡ã§ã‚‚ä¸ãˆã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚"
        ];

        let current = 0;
        let answers = [];
        let userId = "";

        async function init() {
            await liff.init({ liffId: "2009176797-S5FV668D" });
            if (!liff.isLoggedIn()) { liff.login(); return; }
            userId = (await liff.getProfile()).userId;
        }

        function startTest() {
            document.getElementById('intro-area').style.display = 'none';
            document.getElementById('quiz-area').style.display = 'block';
            showQ();
        }

        function showQ() {
            document.getElementById('q-number').innerText = `Q ${String(current+1).padStart(2,'0')} / 13`;
            document.getElementById('q-text').innerText = questions[current];
            document.getElementById('progress').style.width = `${(current / 13) * 100}%`;
            document.getElementById('back-btn').style.display = current > 0 ? 'inline-block' : 'none';
        }

        async function answer(val) {
            answers.push(val);
            current++;
            if (current < questions.length) { showQ(); } 
            else { await saveResult(); }
        }

        function goBack() {
            if (current > 0) {
                current--;
                answers.pop(); // ç›´å‰ã®å›ç­”ã‚’å–ã‚Šæ¶ˆã™
                showQ();
            }
        }

        async function saveResult() {
            document.getElementById('quiz-area').innerHTML = `<div class="text-center py-10"><div class="animate-spin text-4xl mb-4 text-pink-500">ğŸŒ€</div><p class="font-black text-slate-800">åˆ†æä¸­...</p></div>`;
            try {
                let readMind = 0; 
                let adaptAct = 0; 
                answers.forEach((v, i) => { if (i < 6) readMind += v; else adaptAct += v; });
                const total = readMind + adaptAct;
                const resultText = total >= 32.5 ? "HSMï¼ˆç©ºæ°—ã‚’èª­ã‚€ã®ãŒå¾—æ„ãªã‚¿ã‚¤ãƒ—ï¼‰" : "LSMï¼ˆè‡ªåˆ†ã‚’è²«ããƒã‚¤ãƒšãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ï¼‰";

                const data = { total: total, readMind: readMind, adaptAct: adaptAct };
                const apiKey = "AIzaSyD6qGmXgiLp0W7VhNdQYBnCzMnq4TNiQdk";
                const url = `https://firestore.googleapis.com/v1/projects/shinrizemi-linebot/databases/default/documents/users/${userId}?updateMask.fieldPaths=smResult&updateMask.fieldPaths=smDate&updateMask.fieldPaths=smScores&key=${apiKey}`;
                
                await fetch(url, {
                    method: 'PATCH', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ fields: { smResult: { stringValue: resultText }, smDate: { timestampValue: new Date().toISOString() }, smScores: { stringValue: JSON.stringify(data) } } })
                });
                window.location.href = "result.html?type=sm";
            } catch (e) { alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚"); window.location.href = "result.html?type=sm"; }
        }
        init();
    </script>
</body>
</html>