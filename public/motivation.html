<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>ã‚„ã‚‹æ°—ï¼˜ã‚¿ã‚¤ãƒ—è¨ºæ–­ | åŒ—å¤§å¿ƒç†ã‚¼ãƒŸ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: 'Zen Maru Gothic', sans-serif; background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab); background-size: 400% 400%; animation: aurora 20s ease infinite; min-height: 100vh; display: flex; flex-direction: column; }
        @keyframes aurora { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .glass-panel { background: rgba(255, 255, 255, 0.82); backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.4); }
        .choice-btn { transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .choice-btn:active { transform: scale(0.94); background: white; }
        .progress-bar { transition: width 0.4s ease; }
    </style>
</head>
<body class="safe-area-inset-top p-6">
    <header class="text-center mb-8">
        <p class="text-[10px] font-black text-white/70 tracking-[0.4em] mb-1">HOKKAIDO UNIVERSITY</p>
        <h1 class="text-xl font-black text-white drop-shadow-md tracking-tighter">ã‚„ã‚‹æ°—ï¼˜ã‚¿ã‚¤ãƒ—è¨ºæ–­ ğŸ”¥</h1>
    </header>

    <main class="flex-1 flex flex-col justify-center">
        <div id="intro-area" class="glass-panel rounded-[3rem] p-8 shadow-2xl text-center">
            <div class="text-5xl mb-4">ğŸ”¥</div>
            <h2 class="text-lg font-black text-indigo-950 mb-4">ã‚ãªãŸã®ã€Œã‚„ã‚‹æ°—ã‚¹ã‚¤ãƒƒãƒã€<br>ã©ã“ã«ã‚ã‚‹ï¼Ÿ</h2>
            <p class="text-sm text-indigo-900/80 font-bold leading-relaxed mb-8 text-left">
                ã‚³ãƒ­ãƒ³ãƒ“ã‚¢å¤§å­¦ã®å¿ƒç†å­¦ç ”ç©¶ã«åŸºã¥ãè¨ºæ–­ã§ã™ã€‚<br><br>
                ã€Œè¤’ã‚ã‚‰ã‚ŒãŸã„ã€ã€Œå¤±æ•—ã—ãŸããªã„ã€ãªã©ã€ã‚ãªãŸãŒã©ã‚“ãªçŠ¶æ³ã§ä¸€ç•ªãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãŒä¸ŠãŒã‚‹ã®ã‹ã‚’8ã¤ã®ã‚¿ã‚¤ãƒ—ã‹ã‚‰ç‰¹å®šã—ã¾ã™ï¼
            </p>
            <button onclick="startTest()" class="choice-btn w-full py-4 bg-orange-500 rounded-[2rem] font-black text-white shadow-lg text-lg">
                è¨ºæ–­ã‚’ã‚¹ã‚¿ãƒ¼ãƒˆï¼ ğŸš€
            </button>
        </div>

        <div id="quiz-area" class="glass-panel rounded-[3rem] p-8 shadow-2xl relative overflow-hidden" style="display: none;">
            <div class="absolute top-0 left-0 w-full h-2 bg-white/30">
                <div id="progress" class="progress-bar h-full bg-orange-500" style="width: 0%"></div>
            </div>
            <div class="pt-4 text-center">
                <span id="q-number" class="text-[10px] font-black text-orange-500 tracking-[0.2em] uppercase">STEP 01</span>
                <h2 id="q-text" class="text-xl font-black mt-4 mb-8 leading-relaxed text-indigo-950 min-h-[5rem]">
                    </h2>
                <div class="space-y-4">
                    <button id="btn-1" onclick="answer(1)" class="choice-btn w-full py-5 bg-white/60 rounded-[2rem] font-black text-indigo-950 shadow-sm border border-white">
                        </button>
                    <button id="btn-0" onclick="answer(0)" class="choice-btn w-full py-5 bg-white/60 rounded-[2rem] font-black text-indigo-950 shadow-sm border border-white">
                        </button>
                </div>
                <button id="back-btn" onclick="goBack()" class="mt-6 text-sm font-bold text-indigo-900/50 underline active:text-orange-500" style="display: none;">
                    â—€ ä¸€ã¤å‰ã®å•é¡Œã«æˆ»ã‚‹
                </button>
            </div>
        </div>
    </main>
    <footer class="mt-8 text-center"><p class="text-[10px] text-white/50 tracking-widest uppercase">Â© 2026 åŒ—å¤§å¿ƒç†ã‚¼ãƒŸ</p></footer>

    <script>
    const questions = [
        { t: "èƒ½åŠ›ã¯åŠªåŠ›æ¬¡ç¬¬ã§ã€ã„ãã‚‰ã§ã‚‚ä¼¸ã°ã›ã‚‹ã¨æ€ã†ï¼Ÿ", ans1: "åŠªåŠ›ã§ä¼¸ã³ã‚‹ï¼ğŸ“ˆ", ans0: "æ‰èƒ½ã§æ±ºã¾ã‚‹ ğŸ§Š", axis: "mindset" },
        { t: "æ–°ã—ã„ã“ã¨ã«æŒ‘æˆ¦ã—ã¦å¤±æ•—ã™ã‚‹ã‚ˆã‚Šã€ä»Šã®ã¾ã¾ãŒè‰¯ã„ï¼Ÿ", ans1: "å¤±æ•—ã—ã¦ã‚‚æŒ‘æˆ¦ï¼ğŸš€", ans0: "ç¾çŠ¶ã‚’ç¶­æŒã—ãŸã„ ğŸ›¡ï¸", axis: "mindset", reverse: true },
        { t: "ç›®æ¨™ã‚’é”æˆã—ã¦ã€Œã™ã”ã„ï¼ã€ã¨è¨€ã‚ã‚Œã‚‹ã®ãŒä¸€ç•ªã®å–œã³ï¼Ÿ", ans1: "è³è³›ãŒã»ã—ã„ï¼ğŸŒŸ", ans0: "ç‰¹ã«æ±‚ã‚ãªã„ ğŸƒ", axis: "focus" },
        { t: "ãƒŸã‚¹ã‚’ã—ã¦èª°ã‹ã«æ€’ã‚‰ã‚Œã‚‹ã®ã¯ã€ä½•ã¨ã—ã¦ã‚‚é¿ã‘ãŸã„ï¼Ÿ", ans1: "çµ¶å¯¾ã«é¿ã‘ãŸã„ ğŸš«", ans0: "ã‚ã¾ã‚Šæ°—ã«ã—ãªã„ ğŸ•Šï¸", axis: "focus", reverse: true },
        { t: "é›£ã—ã„èª²é¡Œã«å‡ºä¼šã£ãŸã¨ãã€ã€Œè‡ªåˆ†ãªã‚‰ã§ãã‚‹ã€ã¨æ€ãˆã‚‹ï¼Ÿ", ans1: "ã§ãã‚‹æ°—ãŒã™ã‚‹ï¼ğŸ”¥", ans0: "ä¸å®‰ãŒå‹ã¤ ğŸ’¦", axis: "confidence" },
        { t: "å‘¨ã‚Šã®äººã¨æ¯”ã¹ã¦ã€è‡ªåˆ†ã¯å™¨ç”¨ã«ã“ãªã›ã‚‹æ–¹ã ã¨æ€ã†ï¼Ÿ", ans1: "è‡ªä¿¡ãŒã‚ã‚‹ âœ¨", ans0: "è‡ªä¿¡ãŒãªã„ ğŸ“‰", axis: "confidence" }
    ];

    let current = 0;
    let userAnswers = []; // æˆ»ã‚Œã‚‹ã‚ˆã†ã«å›ç­”å±¥æ­´ã‚’ä¿å­˜
    let userId = "";

    async function initializeLiff() {
        try {
            await liff.init({ liffId: "2009176797-haV5S7AC" }); 
            if (!liff.isLoggedIn()) { liff.login(); return; }
            userId = (await liff.getProfile()).userId;
        } catch (err) { console.error("LIFFã‚¨ãƒ©ãƒ¼:", err); }
    }

    function startTest() {
        document.getElementById('intro-area').style.display = 'none';
        document.getElementById('quiz-area').style.display = 'block';
        updateUI();
    }

    function updateUI() {
        const q = questions[current];
        document.getElementById('q-number').innerText = `STEP ${String(current + 1).padStart(2, '0')} / 06`;
        document.getElementById('q-text').innerText = q.t;
        document.getElementById('btn-1').innerText = q.ans1;
        document.getElementById('btn-0').innerText = q.ans0;
        document.getElementById('progress').style.width = `${(current / questions.length) * 100}%`;
        document.getElementById('back-btn').style.display = current > 0 ? 'inline-block' : 'none';
    }

    function answer(val) {
        userAnswers[current] = val;
        current++;
        if (current < questions.length) {
            updateUI();
        } else {
            document.getElementById('quiz-area').innerHTML = `<div class="text-center py-10"><div class="animate-spin text-4xl mb-4">ğŸŒ€</div><p class="font-black text-indigo-950">çµæœã‚’åˆ†æä¸­...</p></div>`;
            sendResult();
        }
    }

    function goBack() {
        if (current > 0) {
            current--;
            updateUI();
        }
    }

async function sendResult() {
        let scores = { mindset: 0, focus: 0, confidence: 0 };
        questions.forEach((q, i) => {
            let val = userAnswers[i];
            scores[q.axis] += q.reverse ? (val === 1 ? 0 : 1) : val;
        });

        const G = scores.mindset >= 1; const P = scores.focus >= 1; const H = scores.confidence >= 1;
        let type = "";
        if (G && P && H) type = "ã‚¨ãƒªãƒ¼ãƒˆ"; else if (G && P && !H) type = "æ–°æ˜Ÿ"; else if (G && !P && H) type = "æˆ¦ç•¥å®¶"; else if (G && !P && !H) type = "è‡†ç—…è€…"; else if (!G && P && H) type = "ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰"; else if (!G && P && !H) type = "ãƒ“ã‚®ãƒŠãƒ¼"; else if (!G && !P && H) type = "ç†Ÿç·´è€…"; else type = "å‡¡äºº";

        if (userId) {
            const apiKey = "AIzaSyD6qGmXgiLp0W7VhNdQYBnCzMnq4TNiQdk";
            const url = `https://firestore.googleapis.com/v1/projects/shinrizemi-linebot/databases/default/documents/users/${userId}?updateMask.fieldPaths=motivationResult&updateMask.fieldPaths=motivationDate&updateMask.fieldPaths=motivationScores&updateMask.fieldPaths=latestTest&key=${apiKey}`;
            const payload = { 
                fields: { 
                    motivationResult: { stringValue: "ã‚„ã‚‹æ°—ï¼š" + type }, 
                    motivationDate: { timestampValue: new Date().toISOString() },
                    motivationScores: { stringValue: JSON.stringify(scores) },
                    latestTest: { stringValue: "motivation" }
                } 
            };
            try { 
                await fetch(url, { method: 'PATCH', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }); 
            } catch (err) {
                console.error("ä¿å­˜ã‚¨ãƒ©ãƒ¼:", err);
            }
        }

        // â˜…å¤§é€²åŒ–ï¼šLINEã«é€ä¿¡ã›ãšã€ãã®ã¾ã¾ãƒãƒ¼ã‚¿ãƒ«ç”»é¢ï¼ˆtest.htmlï¼‰ã¸ç§»å‹•ã™ã‚‹ï¼
        window.location.href = "result.html?type=motivation";
    }
    initializeLiff();

    </script>
</body>
</html>